# 5-Layer Neural Network: Forward and Backward Propagation

```
══════════════════════════════════════════════════════════════════════════════════════════════════════════
                                        FORWARD PROPAGATION
══════════════════════════════════════════════════════════════════════════════════════════════════════════

    INPUT          LAYER 1           LAYER 2           LAYER 3           LAYER 4           LAYER 5
     (X)                                                                                   (Output)

                   Z¹ = W¹·X + b¹    Z² = W²·A¹ + b²   Z³ = W³·A² + b³   Z⁴ = W⁴·A³ + b⁴   Z⁵ = W⁵·A⁴ + b⁵
                   A¹ = g¹(Z¹)       A² = g²(Z²)       A³ = g³(Z³)       A⁴ = g⁴(Z⁴)       A⁵ = g⁵(Z⁵)

                      W¹, b¹            W², b²            W³, b³            W⁴, b⁴            W⁵, b⁵
                        │                 │                 │                 │                 │
                        ▼                 ▼                 ▼                 ▼                 ▼
     ┌───┐          ┌───────┐         ┌───────┐         ┌───────┐         ┌───────┐         ┌───────┐
     │ ○ │─────────▶│ ○  Z¹ │────────▶│ ○  Z² │────────▶│ ○  Z³ │────────▶│ ○  Z⁴ │────────▶│ ○  Z⁵ │
     │ ○ │─────────▶│ ○  ↓  │────────▶│ ○  ↓  │────────▶│ ○  ↓  │────────▶│ ○  ↓  │────────▶│ ○  ↓  │───▶ Ŷ
     │ ○ │─────────▶│ ○  A¹ │────────▶│ ○  A² │────────▶│ ○  A³ │────────▶│ ○  A⁴ │────────▶│ ○  A⁵ │
     │ ○ │─────────▶│ ○     │────────▶│ ○     │────────▶│ ○     │────────▶│       │         │       │
     │ ○ │          │ ○     │         │ ○     │         │       │         │       │         │       │
     └───┘          └───────┘         └───────┘         └───────┘         └───────┘         └───────┘
      A⁰               A¹                A²                A³                A⁴                A⁵


══════════════════════════════════════════════════════════════════════════════════════════════════════════
                                       BACKWARD PROPAGATION
══════════════════════════════════════════════════════════════════════════════════════════════════════════

                                                                                              LOSS
    INPUT          LAYER 1           LAYER 2           LAYER 3           LAYER 4           LAYER 5
     (X)                                                                                   (Output)

                                                                                         dZ⁵ = A⁵ - Y
                 dZ¹=(W²)ᵀ·dZ²      dZ²=(W³)ᵀ·dZ³     dZ³=(W⁴)ᵀ·dZ⁴     dZ⁴=(W⁵)ᵀ·dZ⁵    dW⁵ = 1/m·dZ⁵·(A⁴)ᵀ
                     *g'¹(Z¹)           *g'²(Z²)          *g'³(Z³)          *g'⁴(Z⁴)      db⁵ = 1/m·Σ dZ⁵
                                                                                              │
                   dW¹, db¹           dW², db²           dW³, db³          dW⁴, db⁴           │
                      │                  │                  │                 │               │
                      ▼                  ▼                  ▼                 ▼               ▼
     ┌───┐          ┌───────┐         ┌───────┐         ┌───────┐         ┌───────┐         ┌───────┐
     │   │◀─────────│   dZ¹ │◀────────│   dZ² │◀────────│   dZ³ │◀────────│   dZ⁴ │◀────────│   dZ⁵ │
     │   │  dA¹     │   ↓   │  dA²    │   ↓   │  dA³    │   ↓   │  dA⁴    │   ↓   │  dA⁵    │   ↓   │◀─── ∂L/∂A⁵
     │   │◀─────────│  dW¹  │◀────────│  dW²  │◀────────│  dW³  │◀────────│  dW⁴  │◀────────│  dW⁵  │
     │   │          │  db¹  │         │  db²  │         │  db³  │         │  db⁴  │         │  db⁵  │
     │   │          │       │         │       │         │       │         │       │         │       │
     └───┘          └───────┘         └───────┘         └───────┘         └───────┘         └───────┘
      X                                                                                        Y


══════════════════════════════════════════════════════════════════════════════════════════════════════════
                                      GRADIENT FLOW DETAIL
══════════════════════════════════════════════════════════════════════════════════════════════════════════

    For each layer l (from L=5 down to l=1):

    ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
    │                                                                                                 │
    │   Layer l+1                          Layer l                              Layer l-1             │
    │                                                                                                 │
    │                                 ┌──────────────────┐                                            │
    │                                 │                  │                                            │
    │      dZˡ⁺¹ ─────────────────▶  │   dAˡ = (Wˡ⁺¹)ᵀ·dZˡ⁺¹                                        │
    │              (Wˡ⁺¹)ᵀ           │        │                                                       │
    │                                 │        ▼                                                       │
    │                                 │   dZˡ = dAˡ * g'ˡ(Zˡ)  ◀──── Element-wise multiply           │
    │                                 │        │                                                       │
    │                                 │        ├──────────────▶  dWˡ = (1/m) · dZˡ · (Aˡ⁻¹)ᵀ         │
    │                                 │        │                                                       │
    │                                 │        └──────────────▶  dbˡ = (1/m) · Σ dZˡ                  │
    │                                 │                                                                │
    │                                 └──────────────────┘                                            │
    │                                                                                                 │
    └─────────────────────────────────────────────────────────────────────────────────────────────────┘


══════════════════════════════════════════════════════════════════════════════════════════════════════════
                                    COMPLETE EQUATIONS SUMMARY
══════════════════════════════════════════════════════════════════════════════════════════════════════════

    ┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
    │  FORWARD                          │  BACKWARD                                                   │
    ├───────────────────────────────────┼─────────────────────────────────────────────────────────────┤
    │                                   │                                                             │
    │  Z¹ = W¹·A⁰ + b¹                  │  dZ⁵ = A⁵ - Y                      ← Output layer          │
    │  A¹ = g¹(Z¹)                      │  dW⁵ = (1/m) · dZ⁵ · (A⁴)ᵀ                                  │
    │                                   │  db⁵ = (1/m) · Σ dZ⁵                                        │
    │  Z² = W²·A¹ + b²                  │                                                             │
    │  A² = g²(Z²)                      │  dA⁴ = (W⁵)ᵀ · dZ⁵                 ← Hidden layers         │
    │                                   │  dZ⁴ = dA⁴ * g'⁴(Z⁴)                                        │
    │  Z³ = W³·A² + b³                  │  dW⁴ = (1/m) · dZ⁴ · (A³)ᵀ                                  │
    │  A³ = g³(Z³)                      │  db⁴ = (1/m) · Σ dZ⁴                                        │
    │                                   │                                                             │
    │  Z⁴ = W⁴·A³ + b⁴                  │  dA³ = (W⁴)ᵀ · dZ⁴                                          │
    │  A⁴ = g⁴(Z⁴)                      │  dZ³ = dA³ * g'³(Z³)                                        │
    │                                   │  dW³ = (1/m) · dZ³ · (A²)ᵀ                                  │
    │  Z⁵ = W⁵·A⁴ + b⁵                  │  db³ = (1/m) · Σ dZ³                                        │
    │  A⁵ = g⁵(Z⁵)                      │                                                             │
    │                                   │  dA² = (W³)ᵀ · dZ³                                          │
    │        │                          │  dZ² = dA² * g'²(Z²)                                        │
    │        ▼                          │  dW² = (1/m) · dZ² · (A¹)ᵀ                                  │
    │       Ŷ = A⁵                      │  db² = (1/m) · Σ dZ²                                        │
    │        │                          │                                                             │
    │        ▼                          │  dA¹ = (W²)ᵀ · dZ²                                          │
    │   L = Loss(Ŷ, Y)                  │  dZ¹ = dA¹ * g'¹(Z¹)                                        │
    │                                   │  dW¹ = (1/m) · dZ¹ · (X)ᵀ                                   │
    │                                   │  db¹ = (1/m) · Σ dZ¹                                        │
    │                                   │                                                             │
    └───────────────────────────────────┴─────────────────────────────────────────────────────────────┘


══════════════════════════════════════════════════════════════════════════════════════════════════════════
                                      PARAMETER UPDATE
══════════════════════════════════════════════════════════════════════════════════════════════════════════

    For each layer l = 1, 2, 3, 4, 5:

        Wˡ  :=  Wˡ  -  α · dWˡ
        bˡ  :=  bˡ  -  α · dbˡ

    Where α = learning rate

══════════════════════════════════════════════════════════════════════════════════════════════════════════
```

## Key Insights

| Direction | Flow | Computes |
|-----------|------|----------|
| **Forward** | X → A¹ → A² → A³ → A⁴ → A⁵ → Ŷ | Predictions |
| **Backward** | dZ⁵ ← dZ⁴ ← dZ³ ← dZ² ← dZ¹ | Gradients |

## Variable Reference

| Symbol | Meaning |
|--------|---------|
| **X = A⁰** | Input features |
| **Wˡ** | Weight matrix for layer l |
| **bˡ** | Bias vector for layer l |
| **Zˡ** | Linear output: `Zˡ = Wˡ · Aˡ⁻¹ + bˡ` |
| **Aˡ** | Activation output: `Aˡ = gˡ(Zˡ)` |
| **gˡ** | Activation function (ReLU, sigmoid, etc.) |
| **g'ˡ** | Derivative of activation function |
| **Ŷ = A⁵** | Final prediction |
| **dZˡ** | Gradient of loss w.r.t. Zˡ |
| **dWˡ** | Gradient of loss w.r.t. Wˡ |
| **dbˡ** | Gradient of loss w.r.t. bˡ |
| **dAˡ** | Gradient of loss w.r.t. Aˡ |
| **m** | Number of training samples |
| **α** | Learning rate |
